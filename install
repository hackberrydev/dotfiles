#!/usr/bin/env bash
set -e

here="$(dirname "$0")"
here="$(cd "$here"; pwd)"

echo "Download package lists"
sudo apt-get update -q -y 2>&1 >/dev/null

echo "Install basic tools"
sudo apt-get install -y git make vim zsh tmux ack-grep 2>&1 >/dev/null

echo "Install oh-my-zsh"
git clone git://github.com/robbyrussell/oh-my-zsh.git ~/.oh-my-zsh

echo "Switch to zsh"
chsh -s $(which zsh)

echo "Link dotfiles"
for file in "$here"/*; do
name="$(basename "$file" .md)"
  [[ $name = bin ]] && dotname="$name" || dotname=".${name}"

  if [[ !( "install README" =~ $name || -e ~/$dotname || -d $file/.git ) ]]; then
    ln -sfv ${file#$HOME/} "${HOME}/${dotname}"
  fi
done

echo "Configure git"
git config --global user.email "nebojsa.stricevic@gmail.com"
git config --global user.name "Nebojša Stričević"
git config --global push.default current
ssh-keyscan github.com >> ~/.ssh/known_hosts

echo "Install vimfiles"
git clone git@github.com:strika/vimfiles.git ~/.vim
cd ~/.vim && rake
